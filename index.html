<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#D97757">
  <title>Bozzone Tasks</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.svg">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --accent: #D97757;
      --accent-light: #fff3ec;
      --accent-dark: #7a3a1e;
      --bg: #faf9f5;
      --card-bg: #fff;
      --card-header-bg: #f5f4ef;
      --border: #e5e4df;
      --text: #141413;
      --text-sec: #888;
      --text-muted: #aaa;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 12px;
      padding-bottom: calc(16px + var(--safe-bottom));
      min-height: 100vh;
      min-height: 100dvh;
      -webkit-tap-highlight-color: transparent;
    }

    /* ── Header ─────────────────────────────────── */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 10px;
      margin-bottom: 14px;
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 100;
      padding-top: env(safe-area-inset-top, 4px);
    }

    header h1 {
      font-size: 1.1rem;
      color: var(--accent);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .hdr-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .sync-dot {
      width: 9px; height: 9px;
      border-radius: 50%;
      background: #ccc;
      transition: background .3s;
    }
    .sync-dot.on  { background: #4CAF50; }
    .sync-dot.wait { background: #FFC107; }
    .sync-dot.off  { background: #F44336; }

    .key-label {
      font-size: .7rem;
      color: var(--text-sec);
      cursor: pointer;
    }

    .gear {
      background: none; border: none;
      font-size: 1.15rem; cursor: pointer;
      padding: 4px; opacity: .45;
    }
    .gear:hover, .gear:active { opacity: 1; }

    /* ── Focus Banner ───────────────────────────── */
    .focus {
      background: var(--accent-light);
      border-left: 4px solid var(--accent);
      padding: 9px 12px;
      border-radius: 4px;
      margin-bottom: 14px;
      font-size: .84rem;
      color: var(--accent-dark);
      line-height: 1.4;
    }

    /* ── Overall Progress ───────────────────────── */
    .overall {
      margin-bottom: 16px;
      padding: 10px 14px;
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,.07);
    }
    .overall-top {
      display: flex;
      justify-content: space-between;
      font-size: .82rem;
      margin-bottom: 5px;
      color: var(--text-sec);
    }
    .bar-wrap {
      background: #eee;
      border-radius: 6px;
      height: 7px;
      overflow: hidden;
    }
    .bar {
      height: 100%;
      background: var(--accent);
      border-radius: 6px;
      transition: width .35s ease;
    }

    /* ── Grid ────────────────────────────────────── */
    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media (min-width: 700px)  { .grid { grid-template-columns: repeat(2,1fr); } body { padding: 20px; } header h1 { font-size: 1.35rem; } }
    @media (min-width: 1100px) { .grid { grid-template-columns: repeat(3,1fr); } }

    /* ── Cards ───────────────────────────────────── */
    .card {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,.07);
      overflow: hidden;
    }
    .card-hd {
      background: var(--card-header-bg);
      padding: 11px 14px;
      font-weight: 600;
      font-size: .88rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card-hd .badge {
      background: var(--accent);
      color: #fff;
      font-size: .7rem;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: 500;
      flex-shrink: 0;
    }
    .card-bd { padding: 10px 14px; }

    .priority .card-hd {
      background: var(--accent-light);
      border-bottom-color: #f8d5c2;
    }

    /* ── Progress per card ───────────────────────── */
    .prog-wrap {
      background: #eee;
      border-radius: 4px;
      height: 4px;
      margin: 6px 0 3px;
      overflow: hidden;
    }
    .prog {
      height: 100%;
      background: var(--accent);
      border-radius: 4px;
      transition: width .35s ease;
    }
    .prog-lbl {
      font-size: .7rem;
      color: var(--text-muted);
      text-align: right;
      margin-bottom: 4px;
    }

    /* ── Tasks ───────────────────────────────────── */
    .task {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 9px 0;
      border-bottom: 1px solid #f0efea;
      font-size: .86rem;
      line-height: 1.42;
    }
    .task:last-child { border-bottom: none; }

    .task input[type="checkbox"] {
      margin-top: 2px;
      accent-color: var(--accent);
      width: 18px; height: 18px;
      flex-shrink: 0;
      cursor: pointer;
    }
    .task label {
      cursor: pointer;
      color: #333;
      flex: 1;
      user-select: none;
      -webkit-user-select: none;
    }
    .task.done label {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    /* ── Overlay (sync-key setup) ────────────────── */
    .ov {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .ov-box {
      background: #fff;
      border-radius: 14px;
      padding: 28px 22px;
      max-width: 380px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0,0,0,.2);
    }
    .ov-box h2 {
      color: var(--accent);
      margin-bottom: 10px;
      font-size: 1.15rem;
    }
    .ov-box p {
      font-size: .88rem;
      color: #555;
      margin-bottom: 14px;
      line-height: 1.5;
    }
    .ov-box input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      text-align: center;
      font-family: monospace;
      letter-spacing: 2px;
      margin-bottom: 12px;
    }
    .ov-box input:focus {
      outline: none;
      border-color: var(--accent);
    }
    .ov-box button {
      width: 100%;
      padding: 12px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
    }
    .ov-box button:active { opacity: .9; }

    /* ── Config-needed banner ────────────────────── */
    .cfg-banner {
      background: #FFF3CD;
      border: 1px solid #FFEEBA;
      border-radius: 10px;
      padding: 20px 16px;
      margin-bottom: 16px;
    }
    .cfg-banner h2 { color: #856404; font-size: 1rem; margin-bottom: 6px; }
    .cfg-banner p  { color: #856404; font-size: .85rem; line-height: 1.5; }
    .cfg-banner code {
      background: #f8f0d8;
      padding: 1px 5px;
      border-radius: 3px;
      font-size: .82rem;
    }
  </style>
</head>
<body>

<header>
  <h1>Bozzone Tasks</h1>
  <div class="hdr-right">
    <div class="sync-dot" id="dot" title="Sync status"></div>
    <span class="key-label" id="keyLbl" title="Click to change sync key"></span>
    <button class="gear" id="gearBtn" title="Settings">&#9881;</button>
  </div>
</header>

<div class="focus">
  <strong>FOCUS:</strong> YourStoryHomeDesign Social Marketing Plan &mdash; Community Connect News article (March)
</div>

<div id="cfgNote"></div>

<div class="overall">
  <div class="overall-top">
    <span>Overall Progress</span>
    <span id="oPct">0%</span>
  </div>
  <div class="bar-wrap">
    <div class="bar" id="oBar" style="width:0%"></div>
  </div>
</div>

<div class="grid" id="board"></div>

<!-- Sync-key overlay -->
<div class="ov" id="ov" style="display:none">
  <div class="ov-box">
    <h2>Sync Setup</h2>
    <p>Enter a sync key below. Use the <strong>same key on every device</strong> to keep tasks in sync.</p>
    <input type="text" id="keyIn" placeholder="e.g. bozzone42" autocomplete="off" autocapitalize="off" spellcheck="false">
    <button id="keyGo">Start Syncing</button>
  </div>
</div>

<script>
/* ================================================================
   FIREBASE CONFIG — Replace with YOUR values (see SETUP.md)
   ================================================================ */
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCmZWuIQ6NzvS2Lhzo725Wf6Cnro6NKWzI",
  authDomain: "todomyway-185c9.firebaseapp.com",
  databaseURL: "https://todomyway-185c9-default-rtdb.firebaseio.com",
  projectId: "todomyway-185c9",
  storageBucket: "todomyway-185c9.firebasestorage.app",
  messagingSenderId: "213165358695",
  appId: "1:213165358695:web:f166a7cc6772f8a54a1ec2"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

/* ================================================================
   TASK DEFINITIONS
   ================================================================ */
var SECTIONS = [
  {
    title: "YourStory \u2014 Pre-Publication",
    icon: "\ud83c\udfaf",
    priority: true,
    tasks: [
      "Verify website contact form is working",
      "Update Google Business profile with fresh photos (before article drops)",
      "Ask Catherine Myers for exact publication date",
      "Confirm if article appears online \u2014 get URL when live",
      "Ask Catherine for permission to use article/excerpts on website and marketing"
    ]
  },
  {
    title: "YourStory \u2014 Post-Publication",
    icon: "\ud83c\udfaf",
    priority: true,
    tasks: [
      "Share article on Facebook page, Instagram, and local groups",
      "Save article as PDF and screenshot for future marketing",
      "Add 'as featured in Community Connect News' to website and bio",
      "Reach out to local interior designers as referral partners (use article as credibility)",
      "Prepare response script for incoming inquiries from article readers",
      "Launch Facebook Ads campaign (once first commission comes in)"
    ]
  },
  {
    title: "Social Marketing Foundation",
    icon: "\ud83d\udcf1",
    tasks: [
      "Identify target audience demographics",
      "Plan content calendar around article launch",
      "Create brand voice and messaging guidelines"
    ]
  },
  {
    title: "MSS \u2014 Miter Saw Station",
    icon: "\ud83d\udee0\ufe0f",
    tasks: [
      "Make saw platform with MDF and speed braces",
      "Install floating brackets",
      "Rip 1/2 inch plywood sheet",
      "Take photographs when complete"
    ]
  },
  {
    title: "Z$ Shopping List",
    icon: "\ud83d\uded2",
    tasks: [
      "Grey paint",
      "1/8 inch hardboard"
    ]
  },
  {
    title: "Retooling for Retirement",
    icon: "\ud83d\udcfa",
    tasks: [
      "Upper Cabs video",
      "Plan video content calendar",
      "Create first video (pick topic from deck)",
      "Reach out to sponsors: Harvey Tools, Bambu Lab, xTool"
    ]
  },
  {
    title: "Product Ideas and Designs",
    icon: "\ud83c\udfd7\ufe0f",
    tasks: [
      "Furniture Designs",
      "Retro Game controller",
      "Novel functional nostalgia",
      "Rolling Packout shelf system"
    ]
  },
  {
    title: "Financial and Admin",
    icon: "\ud83d\udcb0",
    tasks: [
      "Taxes \u2014 $5,106 estimated (need approx $2,426 more)",
      "Set up analog Kanban board to manage projects",
      "Sell tools on eBay"
    ]
  }
];

/* ================================================================
   STATE
   ================================================================ */
var states   = {};
var syncKey  = localStorage.getItem('bozzone-sync-key');
var dbRef    = null;
var fbReady  = false;
var configured = firebaseConfig.apiKey !== 'YOUR_API_KEY';

/* ================================================================
   HELPERS
   ================================================================ */
function tid(title, i) {
  return (title + '-' + i).toLowerCase().replace(/[^a-z0-9]+/g, '-').slice(0, 60);
}

function dot(cls) {
  var el = document.getElementById('dot');
  el.className = 'sync-dot ' + cls;
}

/* ================================================================
   FIREBASE
   ================================================================ */
function initFB() {
  if (!configured) {
    dot('off');
    document.getElementById('cfgNote').innerHTML =
      '<div class="cfg-banner">' +
      '<h2>Firebase Not Configured</h2>' +
      '<p>The app works offline with local storage. To enable cross-device sync, ' +
      'add your Firebase config to <code>index.html</code> and redeploy. ' +
      'See <strong>SETUP.md</strong> for step-by-step instructions.</p></div>';
    loadLS();
    render();
    return;
  }

  try {
    firebase.initializeApp(firebaseConfig);
    fbReady = true;
  } catch (e) {
    dot('off');
    loadLS();
    render();
    return;
  }

  if (syncKey) startSync();
}

function startSync() {
  if (!fbReady || !syncKey) return;
  dot('wait');

  dbRef = firebase.database().ref('dashboards/' + syncKey + '/tasks');

  dbRef.on('value', function(snap) {
    states = snap.val() || {};
    dot('on');
    render();
  }, function() {
    dot('off');
    loadLS();
    render();
  });

  firebase.database().ref('.info/connected').on('value', function(s) {
    dot(s.val() ? 'on' : 'off');
  });

  document.getElementById('keyLbl').textContent = syncKey;
}

function check(id, val) {
  states[id] = val;
  if (fbReady && dbRef) {
    var u = {}; u[id] = val;
    dbRef.update(u);
  }
  saveLS();
  render();
}

/* ================================================================
   LOCAL-STORAGE FALLBACK
   ================================================================ */
function loadLS() {
  try { var s = localStorage.getItem('bozzone-states'); if (s) states = JSON.parse(s); } catch(e) {}
}
function saveLS() {
  try { localStorage.setItem('bozzone-states', JSON.stringify(states)); } catch(e) {}
}

/* ================================================================
   RENDER
   ================================================================ */
function render() {
  var board = document.getElementById('board');
  board.innerHTML = '';

  var totalAll = 0, doneAll = 0;

  SECTIONS.forEach(function(sec) {
    var done = 0, total = sec.tasks.length;
    sec.tasks.forEach(function(_, i) { if (states[tid(sec.title, i)]) done++; });
    totalAll += total;
    doneAll  += done;
    var pct = total ? Math.round(done / total * 100) : 0;

    var card = document.createElement('div');
    card.className = 'card' + (sec.priority ? ' priority' : '');

    /* header */
    var hd = document.createElement('div');
    hd.className = 'card-hd';
    hd.innerHTML = '<span>' + sec.icon + ' ' + sec.title + '</span>' +
                   '<span class="badge">' + done + '/' + total + '</span>';
    card.appendChild(hd);

    /* body */
    var bd = document.createElement('div');
    bd.className = 'card-bd';

    var pw = document.createElement('div'); pw.className = 'prog-wrap';
    var pb = document.createElement('div'); pb.className = 'prog'; pb.style.width = pct + '%';
    pw.appendChild(pb); bd.appendChild(pw);

    var pl = document.createElement('div'); pl.className = 'prog-lbl';
    pl.textContent = pct + '% complete';
    bd.appendChild(pl);

    sec.tasks.forEach(function(txt, i) {
      var id = tid(sec.title, i);
      var on = !!states[id];

      var row = document.createElement('div');
      row.className = 'task' + (on ? ' done' : '');

      var cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.id = 'c-' + id;
      cb.checked = on;
      cb.addEventListener('change', function() { check(id, cb.checked); });

      var lb = document.createElement('label');
      lb.htmlFor = 'c-' + id;
      lb.textContent = txt;

      row.appendChild(cb);
      row.appendChild(lb);
      bd.appendChild(row);
    });

    card.appendChild(bd);
    board.appendChild(card);
  });

  /* overall */
  var op = totalAll ? Math.round(doneAll / totalAll * 100) : 0;
  document.getElementById('oPct').textContent = doneAll + '/' + totalAll + ' (' + op + '%)';
  document.getElementById('oBar').style.width  = op + '%';
}

/* ================================================================
   SYNC-KEY UI
   ================================================================ */
function showOv() {
  document.getElementById('ov').style.display = 'flex';
  var inp = document.getElementById('keyIn');
  inp.value = syncKey || '';
  inp.focus();
}
function hideOv() {
  document.getElementById('ov').style.display = 'none';
}

document.getElementById('keyGo').addEventListener('click', function() {
  var v = document.getElementById('keyIn').value.trim().toLowerCase().replace(/[^a-z0-9\-]/g, '');
  if (!v) { document.getElementById('keyIn').style.borderColor = '#F44336'; return; }
  syncKey = v;
  localStorage.setItem('bozzone-sync-key', syncKey);
  hideOv();
  if (fbReady) startSync();
  else document.getElementById('keyLbl').textContent = syncKey;
});

document.getElementById('keyIn').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') document.getElementById('keyGo').click();
});

document.getElementById('gearBtn').addEventListener('click', showOv);
document.getElementById('keyLbl').addEventListener('click', showOv);

/* ================================================================
   INIT
   ================================================================ */
if (!syncKey) showOv();

loadLS();
render();
initFB();

/* service worker */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(function() {});
}
</script>
</body>
</html>
